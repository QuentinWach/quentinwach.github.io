<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Playing with Shaders | Q. Wach</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Playing with Shaders" />
<meta name="author" content="Quentin Wach" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Explaining briefly what shaders are and then moving on to writing two simple ones in GLSL. The first one similar to a lava lamp and the second one a little mountain range under a blue sky with a distance fog. Turns out, shaders are like painting directly with mathematics." />
<meta property="og:description" content="Explaining briefly what shaders are and then moving on to writing two simple ones in GLSL. The first one similar to a lava lamp and the second one a little mountain range under a blue sky with a distance fog. Turns out, shaders are like painting directly with mathematics." />
<link rel="canonical" href="http://localhost:4000/blog/2024/09/18/first-shaders.html" />
<meta property="og:url" content="http://localhost:4000/blog/2024/09/18/first-shaders.html" />
<meta property="og:site_name" content="Q. Wach" />
<meta property="og:image" content="http://localhost:4000/images/shader_2.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-18T21:38:24+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/images/shader_2.png" />
<meta property="twitter:title" content="Playing with Shaders" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Quentin Wach"},"dateModified":"2024-09-18T21:38:24+02:00","datePublished":"2024-09-18T21:38:24+02:00","description":"Explaining briefly what shaders are and then moving on to writing two simple ones in GLSL. The first one similar to a lava lamp and the second one a little mountain range under a blue sky with a distance fog. Turns out, shaders are like painting directly with mathematics.","headline":"Playing with Shaders","image":"http://localhost:4000/images/shader_2.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/2024/09/18/first-shaders.html"},"url":"http://localhost:4000/blog/2024/09/18/first-shaders.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">

  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.png" ><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Q. Wach" /><script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      TeX: { equationNumbers: { autoNumber: "AMS" } }
    });
  </script>
</head>

</head><body onload="document.body.style.opacity='1'"><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Q. Wach</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a><a class="page-link" href="/blog">Blog</a><a class="page-link" href="/side-projects">Side-Projects</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div style="height: 50px;">
          </br>
        </div>
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Playing with Shaders</h1><p class="post-meta">by 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Quentin Wach</span></span>
      
      
        • 
        20
       min read for 
        3696
       words •
      <time class="dt-published" datetime="2024-09-18T21:38:24+02:00" itemprop="datePublished">
        Sep 18, 2024
      </time></p>
  </header>

  <!-- Add content summary -->
  <div class="content-summary">
    <ul id="markdown-toc"></ul>
  </div>

  <div>
    <div class="post-content e-content" itemprop="articleBody">
      <p>I recently started getting more into low-level programming, implementing physics simulations and graphics which then lead me to write my first shader. And damn… shaders are awesome! But many of the copy-cat tutorials out there are terribly boring. I don’t want to see another colored triangle! Let’s actually (attempt to) build an awesome shader! First, I’ll give a little introduction then I’ll show you two simple shaders I made with detailed comments in the code.</p>

<p>Two of the most amazing examples of scenes created with shaders, raw mathematics, were created by the great and famous Inigo Quilez<sup id="fnref:inigo_web" role="doc-noteref"><a href="#fn:inigo_web" class="footnote" rel="footnote">1</a></sup><sup id="fnref:Inigo_youtube" role="doc-noteref"><a href="#fn:Inigo_youtube" class="footnote" rel="footnote">2</a></sup>, who is also the creator of Shadertoy<sup id="fnref:Shadertoy" role="doc-noteref"><a href="#fn:Shadertoy" class="footnote" rel="footnote">3</a></sup> among many other things:</p>

<div style="display: flex; justify-content: space-between; gap: 0px; margin-bottom: 10px;">
    <img src="/images/i_1.png" style="width: 49%; border-radius: 5px;" />
    <img src="/images/i_2.png" style="width: 49%; border-radius: 5px;" />
</div>

<p>The left shows a beautiful mountain landscape with a forest under a sunny sky<sup id="fnref:shader1" role="doc-noteref"><a href="#fn:shader1" class="footnote" rel="footnote">4</a></sup>. The right shows a greek temple<sup id="fnref:shader2" role="doc-noteref"><a href="#fn:shader2" class="footnote" rel="footnote">5</a></sup>. Both are live-rendered shaders by Inigo Quilez, @iquilezles and iquilezles.org.</p>

<!--
<iframe width="100%" height="360" frameborder="0" src="https://www.shadertoy.com/embed/4ttSWf?gui=true&t=10&paused=true&muted=false" allowfullscreen></iframe>
<iframe width="100%" height="360" frameborder="0" src="https://www.shadertoy.com/embed/ldScDh?gui=true&t=10&paused=true&muted=false" allowfullscreen></iframe>
-->

<p>There are no sculpted or modelled objects in these scenes. Everything was defined and rendered using a complex composition of very simply equations. How?</p>

<h2 id="opengl-shaders-rendering-parallelism-on-the-gpu">OpenGL Shaders: Rendering Parallelism On the GPU</h2>
<p>OpenGL is probably the most common/known shader language and if you have any more technical questions you should definitely read through their website/documentation<sup id="fnref:OpenGL" role="doc-noteref"><a href="#fn:OpenGL" class="footnote" rel="footnote">6</a></sup>.</p>

<blockquote>
  <p>“A shader is a set of instructions to the GPU which are executed all at once for every pixel on the screen.”<sup id="fnref:TheHappyCat" role="doc-noteref"><a href="#fn:TheHappyCat" class="footnote" rel="footnote">7</a></sup></p>
</blockquote>

<p>The basic idea of shaders is simply to parallelize, to compute using all the available resources a GPU provides in parallel. That is typically graphics but it can frankly be whatever you want. Thus, a core idea is to keep dependencies as little as possible. The program should typically only be linear, deterministic. You have a simple input like the pixel position on the screen and the shader will know exactly what to do. This is what makes it parallelizable. The more it depends on what is going on at other positions on the screen or other data or even previous data, the less parallelizable it will be and the less we’ll be able to truly make use of the power of the GPU.</p>

<h2 id="drawing-objects-with-vertex-and-fragmentpixel-shaders">Drawing Objects with Vertex and Fragment/Pixel Shaders</h2>
<p>If we want to draw a object, we need to define the points that make the geometry of the object. That’s what the CPU does. (Sad.) We’ll then pass that input point information (vertices) to the GPU. The vertex shader then figures out where to draw these points on the screen. The fragment shader figures out what color each spot on the surface of the object should be<sup id="fnref:Barney" role="doc-noteref"><a href="#fn:Barney" class="footnote" rel="footnote">8</a></sup>.</p>

<p>Of course, there are many more shaders like geometry and compute shaders. But alas…
A faster way which can directly utilize the GPU is defining distance functions!</p>

<p>But I dislike reading and watching tutorial after tutorial. So let’s just get started!</p>

<h2 id="example-1-lava-lamp">Example #1: Lava Lamp</h2>
<p>My first own shader (aside from the typical color gradients one does which is pretty much the “hello world” of shaders) is an animation comparable to a lava lamp. Or maybe spraying blood. 😅
Here is the code:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef GL_ES
</span><span class="n">precision</span> <span class="n">mediump</span> <span class="kt">float</span><span class="p">;</span>
<span class="cp">#endif
</span>
<span class="n">uniform</span> <span class="n">vec2</span> <span class="n">u_resolution</span><span class="p">;</span>
<span class="n">uniform</span> <span class="kt">float</span> <span class="n">u_time</span><span class="p">;</span>
  
<span class="n">vec3</span> <span class="n">colorA</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mo">055</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mo">001</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mo">010</span><span class="p">);</span>
<span class="n">vec3</span> <span class="n">colorB</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mo">000</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mo">000</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">134</span><span class="p">);</span>
  
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">color</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mo">000</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mo">000</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mo">000</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">pct</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">u_time</span><span class="p">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// Add a warped, animated circle</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">st</span> <span class="o">=</span> <span class="n">gl_FragCoord</span><span class="p">.</span><span class="n">xy</span> <span class="o">/</span> <span class="n">u_resolution</span><span class="p">.</span><span class="n">xy</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">center</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">radius</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">252</span><span class="p">;</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// Create warping effect</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">warpFactor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">4</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">warpSpeed</span> <span class="o">=</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">warp</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">sin</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span> <span class="o">+</span> <span class="n">u_time</span> <span class="o">*</span> <span class="n">warpSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="n">warpFactor</span><span class="p">,</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">cos</span><span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span> <span class="o">+</span> <span class="n">u_time</span> <span class="o">*</span> <span class="n">warpSpeed</span><span class="p">)</span> <span class="o">*</span> <span class="n">warpFactor</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// Apply warping to the coordinates</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">st</span> <span class="o">+=</span> <span class="n">warp</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">dist</span> <span class="o">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">center</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">circle</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="n">radius</span> <span class="o">-</span> <span class="mi">0</span><span class="p">.</span><span class="mo">005</span><span class="p">,</span> <span class="n">dist</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">pct</span> <span class="o">=</span> <span class="n">circle</span><span class="p">;</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// Mix uses pct (a value from 0-1) to</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// mix the two colors</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">color</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">colorA</span><span class="p">,</span> <span class="n">colorB</span><span class="p">,</span> <span class="n">pct</span><span class="p">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<style>
    img[alt=IMAGE2] {
        display: block;
        width: 50%;
        border-radius: 5px;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 0px;
        margin-top: 25px;
    }
    .image-container {
        position: relative;
        width: 100%;
        margin: 25px auto 0;
    }
    .image-blur {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        filter: blur(40px);
        opacity: 0.1;
        z-index: 1;
    }
    .image-main {
        position: relative;
        z-index: 2;
    }
</style>

<div class="image-container">
    <img src="/images/shader_1.png" alt="IMAGE2-blur" class="image-blur" />
    <img src="/images/shader_1.png" alt="IMAGE2" class="image-main" />
</div>

<div style="text-align: center; margin-bottom: 15px;">
    <span style="font-size: 14px;">
        My first shader, red drops moving from right to left, merging and splitting smoothly.
    </span>
</div>

<p>Okay. This was quite straightforward. So I wanted to attempt something similar like that landscape Inigo made! I pretty much hacked this together, there is a lot wrong with the following code but it does produce a somewhat pleasing result.</p>

<h2 id="example-2-mountain-range">Example #2: Mountain Range</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifdef GL_ES
</span><span class="n">precision</span> <span class="n">mediump</span> <span class="kt">float</span><span class="p">;</span>
<span class="cp">#endif
</span>
<span class="n">uniform</span> <span class="n">vec2</span> <span class="n">u_resolution</span><span class="p">;</span>
<span class="n">uniform</span> <span class="n">vec2</span> <span class="n">u_mouse</span><span class="p">;</span>
<span class="n">uniform</span> <span class="kt">float</span> <span class="n">u_time</span><span class="p">;</span>

<span class="c1">// Camera settings</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">FOV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">NEAR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">FAR</span> <span class="o">=</span> <span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// Updated terrain settings</span>
<span class="k">const</span> <span class="n">vec3</span> <span class="n">TERRAIN_COLOR</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">339</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">600</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">194</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">TERRAIN_HEIGHT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">580</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">TERRAIN_SCALE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">244</span><span class="p">;</span>

<span class="c1">// Ray marching settings</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_STEPS</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">MAX_DIST</span> <span class="o">=</span> <span class="mi">200</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">EPSILON</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>

<span class="c1">// Noise settings</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">OCTAVES</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">PERSISTENCE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">99</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">LACUNARITY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>

<span class="c1">// Camera to world transformation</span>
<span class="n">mat3</span> <span class="nf">camera</span><span class="p">(</span><span class="n">vec3</span> <span class="n">cameraPos</span><span class="p">,</span> <span class="n">vec3</span> <span class="n">lookAtPos</span><span class="p">,</span> <span class="n">vec3</span> <span class="n">upVector</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">f</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">lookAtPos</span> <span class="o">-</span> <span class="n">cameraPos</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">r</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">cross</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">upVector</span><span class="p">));</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">u</span> <span class="o">=</span> <span class="n">cross</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">mat3</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="o">-</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Improved noise function</span>
<span class="n">vec2</span> <span class="nf">hash2</span><span class="p">(</span><span class="n">vec2</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">p</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">700</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">580</span><span class="p">)),</span> <span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">390</span><span class="p">,</span><span class="mi">0</span><span class="p">.</span><span class="mi">470</span><span class="p">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">872</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="mi">488</span> <span class="o">*</span> <span class="n">fract</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">*</span> <span class="mi">43758</span><span class="p">.</span><span class="mi">321</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">noise</span><span class="p">(</span><span class="n">vec2</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">const</span> <span class="kt">float</span> <span class="n">K1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">342</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">const</span> <span class="kt">float</span> <span class="n">K2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">203</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">i</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">K1</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">a</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">K2</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">o</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">?</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">o</span> <span class="o">+</span> <span class="n">K2</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">+</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">K2</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">h</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">532</span> <span class="o">-</span> <span class="n">vec3</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">)),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">n</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="n">vec3</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">hash2</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">)),</span> 
                                  <span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">hash2</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">o</span><span class="p">)),</span> 
                                  <span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">hash2</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">)));</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">70</span><span class="p">.</span><span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>


<span class="c1">// Updated fBm function</span>
<span class="kt">float</span> <span class="nf">fBm</span><span class="p">(</span><span class="n">vec2</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">value</span> <span class="o">=</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">360</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">756</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">frequency</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">856</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">OCTAVES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">value</span> <span class="o">+=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">noise</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">frequency</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">amplitude</span> <span class="o">*=</span> <span class="n">PERSISTENCE</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">frequency</span> <span class="o">*=</span> <span class="n">LACUNARITY</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Updated terrain function using fBm</span>
<span class="kt">float</span> <span class="nf">terrain</span><span class="p">(</span><span class="n">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">fBm</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">TERRAIN_SCALE</span><span class="p">)</span> <span class="o">*</span> <span class="n">TERRAIN_HEIGHT</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Scene SDF</span>
<span class="kt">float</span> <span class="nf">sceneSDF</span><span class="p">(</span><span class="n">vec3</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">terrain</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Ray marching function</span>
<span class="kt">float</span> <span class="nf">rayMarch</span><span class="p">(</span><span class="n">vec3</span> <span class="n">ro</span><span class="p">,</span> <span class="n">vec3</span> <span class="n">rd</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_STEPS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">ro</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">sceneSDF</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">d</span> <span class="o">+=</span> <span class="n">ds</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">MAX_DIST</span> <span class="o">||</span> <span class="n">abs</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">EPSILON</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">return</span> <span class="n">d</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Add these constants for fog</span>
<span class="k">const</span> <span class="n">vec3</span> <span class="n">FOG_COLOR</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">FOG_DENSITY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">0003</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec2</span> <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">gl_FragCoord</span><span class="p">.</span><span class="n">xy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">.</span><span class="mi">228</span> <span class="o">*</span> <span class="n">u_resolution</span><span class="p">.</span><span class="n">xy</span><span class="p">)</span> <span class="o">/</span> <span class="n">u_resolution</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">// Updated camera setup</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">cameraPos</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">lookAtPos</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">upVector</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">mat3</span> <span class="n">cam</span> <span class="o">=</span> <span class="n">camera</span><span class="p">(</span><span class="n">cameraPos</span><span class="p">,</span> <span class="n">lookAtPos</span><span class="p">,</span> <span class="n">upVector</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">cam</span> <span class="o">*</span> <span class="n">normalize</span><span class="p">(</span><span class="n">vec3</span><span class="p">(</span><span class="n">uv</span><span class="p">,</span> <span class="n">FOV</span><span class="p">));</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// Ray marching</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">d</span> <span class="o">=</span> <span class="n">rayMarch</span><span class="p">(</span><span class="n">cameraPos</span><span class="p">,</span> <span class="n">rd</span><span class="p">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// Sky gradient</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">SKY_COLOR</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">306</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">616</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">965</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">horizon</span> <span class="o">=</span> <span class="n">smoothstep</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mo">060</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">052</span><span class="p">,</span> <span class="n">rd</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">skyGradient</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">FOG_COLOR</span><span class="p">,</span> <span class="n">SKY_COLOR</span><span class="p">,</span> <span class="n">horizon</span><span class="p">);</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// Coloring</span>
<span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">color</span> <span class="o">=</span> <span class="n">skyGradient</span><span class="p">;</span> <span class="c1">// Start with sky gradient</span>
<span class="err"> </span> <span class="err"> </span> <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">MAX_DIST</span><span class="p">)</span> <span class="p">{</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">p</span> <span class="o">=</span> <span class="n">cameraPos</span> <span class="o">+</span> <span class="n">rd</span> <span class="o">*</span> <span class="n">d</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">height</span> <span class="o">=</span> <span class="n">fBm</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">*</span> <span class="n">TERRAIN_SCALE</span><span class="p">)</span> <span class="o">*</span> <span class="n">TERRAIN_HEIGHT</span><span class="p">;</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> 
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// Color based on height</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">color</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">TERRAIN_COLOR</span><span class="p">,</span> <span class="n">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">),</span> 
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">smoothstep</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">TERRAIN_HEIGHT</span><span class="p">,</span> <span class="n">height</span><span class="p">));</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// Add simple shading</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">vec3</span> <span class="n">normal</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">vec3</span><span class="p">(</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fBm</span><span class="p">((</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">+</span> <span class="n">vec2</span><span class="p">(</span><span class="n">EPSILON</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span> <span class="o">*</span> <span class="n">TERRAIN_SCALE</span><span class="p">)</span> 
            <span class="o">-</span> <span class="n">fBm</span><span class="p">((</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">-</span> <span class="n">vec2</span><span class="p">(</span><span class="n">EPSILON</span><span class="p">,</span> <span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">264</span><span class="p">))</span> <span class="o">*</span> <span class="n">TERRAIN_SCALE</span><span class="p">),</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="mi">1</span><span class="p">.</span><span class="mi">688</span> <span class="o">*</span> <span class="n">EPSILON</span><span class="p">,</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">fBm</span><span class="p">((</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">+</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="n">EPSILON</span><span class="p">))</span> <span class="o">*</span> <span class="n">TERRAIN_SCALE</span><span class="p">)</span> 
            <span class="o">-</span> <span class="n">fBm</span><span class="p">((</span><span class="n">p</span><span class="p">.</span><span class="n">xz</span> <span class="o">-</span> <span class="n">vec2</span><span class="p">(</span><span class="o">-</span><span class="mi">0</span><span class="p">.</span><span class="mi">216</span><span class="p">,</span> <span class="n">EPSILON</span><span class="p">))</span> <span class="o">*</span> <span class="n">TERRAIN_SCALE</span><span class="p">)</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="p">));</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">diffuse</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span> <span class="n">normalize</span><span class="p">(</span><span class="n">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">))),</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">color</span> <span class="o">*=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">220</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="mo">076</span> <span class="o">*</span> <span class="n">diffuse</span><span class="p">;</span>

<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="c1">// Apply fog</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="kt">float</span> <span class="n">fogFactor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">FOG_DENSITY</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="err"> </span> <span class="n">color</span> <span class="o">=</span> <span class="n">mix</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">skyGradient</span><span class="p">,</span> <span class="n">fogFactor</span><span class="p">);</span>
<span class="err"> </span> <span class="err"> </span> <span class="p">}</span>

<span class="err"> </span> <span class="err"> </span> <span class="c1">// Add debug grid</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">//vec2 grid = step(fract(uv * 10.0), vec2(0.080, 0.080));</span>
<span class="err"> </span> <span class="err"> </span> <span class="c1">//color = mix(color, vec3(1.000, 0.0, 0.411), max(grid.x, grid.y) * 0.332);</span>

<span class="err"> </span> <span class="err"> </span> <span class="n">gl_FragColor</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<style>
    img[alt=IMAGE2] {
        display: block;
        width: 50%;
        border-radius: 5px;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 0px;
        margin-top: 25px;
    }
    .image-container {
        position: relative;
        width: 100%;
        margin: 25px auto 0;
    }
    .image-blur {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        filter: blur(40px);
        opacity: 0.1;
        z-index: 1;
    }
    .image-main {
        position: relative;
        z-index: 2;
    }
</style>

<div class="image-container">
    <img src="/images/shader_2.png" alt="IMAGE2-blur" class="image-blur" />
    <img src="/images/shader_2.png" alt="IMAGE2" class="image-main" />
</div>

<div style="text-align: center; margin-bottom: 15px;">
    <span style="font-size: 14px;">
    My second shader, a mountain range under a blue sky with a distance fog.
    </span>
</div>

<p>Alright!</p>

<p>Maybe this second shader looks long and intimidating. But if you go through it step by step, it’s not that complicated and almost looks like simple mathematics. I find that very appealing.</p>

<!--
$$
\text{color} = \begin{cases}
\text{mix}(\text{terrainColor}, \text{skyGradient}, f_{\text{fog}}) & \text{if } d < \text{MAX_DIST} \
\text{skyGradient} & \text{otherwise}
\end{cases}
$$

Where:

$$
\begin{align*}
\text{skyGradient} &= \text{mix}(\text{FOG_COLOR}, \text{SKY_COLOR}, h_{\text{horizon}}) \\
h_{\text{horizon}} &= \text{smoothstep}(-0.060, 0.052, \text{rd}y) \\
\text{terrainColor} &= (\text{baseColor} \cdot (0.220 + 1.076 \cdot d{\text{diffuse}})) \\

\text{baseColor} &= \text{mix}(\text{TERRAIN_COLOR}, \text{vec3}(1.0), s_{\text{height}}) \\
s_{\text{height}} &= \text{smoothstep}(0.0, \text{TERRAIN_HEIGHT}, h_{\text{fBm}}) \\
h_{\text{fBm}} &= \text{fBm}(p_{xz} \cdot \text{TERRAIN_SCALE}) \cdot \text{TERRAIN_HEIGHT} \\

d_{\text{diffuse}} &= \max(\text{dot}(\text{normal}, \text{normalize}(\text{vec3}(1.0, 1.0, -1.0))), 0.0) \\
f_{\text{fog}} &= 1.0 - e^{-\text{FOG_DENSITY} \cdot d^2}
\end{align*}

$$
-->

<p>If you want to test these yourself, I created the shaders above (which sadly aren’t animated here) using <a href="https://editor.thebookofshaders.com/">editor.thebookofshaders.com</a> which is very useful for testing shader code live. But if you want to run them locally, you can set up a local server and embed your shader in an html file. It’s boring and beyond the point here though.</p>

<p>I’ll experiment more with this and will try to create more complicated, artistically pleasing shaders in the future. But there is another thing I find quite interesting which somewhat blurs the lines between computing and rendering: compute shaders! (Allowing us to run certain simulations or general computations on the GPU similar to OpenCL but within the GPU’s graphics pipeline.)</p>

<p>But with that, I am happy for now. Onward.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:inigo_web" role="doc-endnote">
      <p><a href="https://iquilezles.org/articles/">Inigo Quilez’s website</a> <a href="#fnref:inigo_web" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:Inigo_youtube" role="doc-endnote">
      <p><a href="https://www.youtube.com/channel/UCdmAhiG8HQDlz8uyekw4ENw">Inigo’s YouTube</a> <a href="#fnref:Inigo_youtube" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:Shadertoy" role="doc-endnote">
      <p><a href="https://www.shadertoy.com/">Shadertoy</a> <a href="#fnref:Shadertoy" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:shader1" role="doc-endnote">
      <p><a href="https://www.shadertoy.com/view/4ttSWf">Shader #1 created by Inigo Quilez on Shadertoy: https://www.shadertoy.com/view/4ttSWf</a> <a href="#fnref:shader1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:shader2" role="doc-endnote">
      <p><a href="https://www.shadertoy.com/view/ldScDh">Shader #2 created by Inigo Quilez on Shadertoy: https://www.shadertoy.com/view/ldScDh</a> <a href="#fnref:shader2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:OpenGL" role="doc-endnote">
      <p><a href="https://www.khronos.org/opengl/wiki/Main_Page">OpenGL Website</a> <a href="#fnref:OpenGL" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:TheHappyCat" role="doc-endnote">
      <p><a href="https://www.youtube.com/watch?v=sXbdF4KjNOc">The Happy Cat’s What Are Shaders? https://www.youtube.com/watch?v=sXbdF4KjNOc</a> <a href="#fnref:TheHappyCat" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:Barney" role="doc-endnote">
      <p><a href="https://www.youtube.com/watch?v=3mfvZ-mdtZQ">Barney Code’s Introduction to Shaders: Learn the Basics! https://www.youtube.com/watch?v=3mfvZ-mdtZQ</a> <a href="#fnref:Barney" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

    </div>
  </div>


<!--
<h4>Did You Enjoy Reading This Article?</h4>
<p>Here are some more articles/posts you might like as well:</p>





<ul>
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
            <li><a href="/science-engineering/2024/07/23/terra.html">TERRA: The Tiny Terrain Generator</a></li>
            

            
        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    

        
        

        

        
    
</ul>
-->


  <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT 
     *  THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR 
     *  PLATFORM OR CMS.
     *  
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: 
     *  https://disqus.com/admin/universalcode/#configuration-variables
     */
    var disqus_config = function () {
        // Replace PAGE_URL with your page's canonical URL variable
        this.page.url = 'http://localhost:4000/blog/2024/09/18/first-shaders.html';  
        
        // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        this.page.identifier = '/blog/2024/09/18/first-shaders'; 
    };
    
    (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
        var d = document, s = d.createElement('script');
        
        // IMPORTANT: Replace EXAMPLE with your forum shortname!
        s.src = 'https://quentinwach.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
    Please enable JavaScript to view the 
    <a href="https://disqus.com/?ref_noscript" rel="nofollow">
        comments powered by Disqus.
    </a>
</noscript><a class="u-url" href="/blog/2024/09/18/first-shaders.html" hidden></a>
</article>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const headings = document.querySelectorAll('.post-content h2, .post-content h3');
    const toc = document.getElementById('markdown-toc');
    let h2Counter = 0;
    let h3Counter = 0;

    headings.forEach((heading, index) => {
      const id = `section-${index}`;
      heading.id = id;
      
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${id}`;
      
      if (heading.tagName === 'H2') {
        h2Counter++;
        h3Counter = 0;
        a.textContent = `${h2Counter}. ${heading.textContent}`;
      } else if (heading.tagName === 'H3') {
        h3Counter++;
        a.textContent = `${h2Counter}.${h3Counter}. ${heading.textContent}`;
        li.style.marginLeft = '20px';
      }
      
      li.appendChild(a);
      toc.appendChild(li);
    });

    if (toc.children.length === 0) {
      document.querySelector('.content-summary').style.display = 'none';
    }
  });
</script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">

      <div class="footer-col">
        <p></p>
      </div>
    
    </div>

    <div class="social-links">
    
      <i>"I just wondered how things were put together."</i> Claude Shannon.
      </br>

      Thank you for visiting!
      You can reach out to me on social media.
      <div class="social-media-list"><div class="social-media-list"><a href="https://x.com/QuentinWach" class="social-link">
      <svg class="svg-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
      </svg>
      <span class="username">QuentinWach</span>
    </a><a href="https://github.com/QuentinWach" class="social-link">
      <svg class="svg-icon" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
      </svg>
      <span class="username">QuentinWach</span>
    </a></div></div>
    </div>

  </div>

</footer><script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function(){
            $('.tag-filter a').click(function(e){
                e.preventDefault();
                var tag = $(this).attr('href').substring(1);
                $('.post').hide();
                $('.post[data-tags~="' + tag + '"]').show();
            });
        });
    </script>


  </body>

</html>